
<!DOCTYPE html>
<html lang="en" xml:lang="en">
<head>
    <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Application of the Memory Block Manager</title>

  

  
    <link rel="index" title="Index" href="genindex.html"/>
    <link rel="top" title="CODESYS LibDevSummary V3.5.21.0 (Draft)" href="index.html"/>
    <link rel="up" title="Advanced Topicâs" href="advanced.html"/> 

<meta property="og:type" content="article">
<meta property="og:title" content="CODESYS Group">
<meta property="og:image" content="https://www.codesys.com/typo3conf/ext/template87/Resources/Public/Images/Og/CODESYS-default.jpg" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="628" />
<meta name="geo.region" content="Kempten" />
<meta name="geo.country" content="Germany" />
<meta name="geo.placename" content="Memminger Stra&szlig;e 151, 87439 Kempten" />
<meta name="geo.position" content="47.321;10.573" />
<meta name="ICBM" content="47.321;10.573" />
<meta name="robots" content="index, follow, noarchive">

<link rel="shortcut icon" href="https://www.codesys.com/typo3conf/ext/template87/Resources/Public/Images/Icons/favicon.ico" type="image/x-icon; charset=binary">
<link rel="icon" href="https://www.codesys.com/typo3conf/ext/template87/Resources/Public/Images/Icons/favicon.ico" type="image/x-icon; charset=binary">
<link href="https://www.codesys.com/typo3conf/ext/template87/Resources/Public/Components/material-design-iconic-font/dist/css/material-design-iconic-font.min.css" rel="stylesheet">
<link href="https://www.codesys.com/typo3conf/ext/template87/Resources/Public/Components/LESS/helpme.min.css" rel="stylesheet">
<link href="https://www.codesys.com/typo3conf/ext/template87/Resources/Public/Components/LESS/helpme_library.min.css" rel="stylesheet">
<link href="https://www.codesys.com/typo3conf/ext/template87/Resources/Public/Components/LESS/microsite.min.css" rel="stylesheet">

<script src="https://www.codesys.com/typo3conf/ext/template87/Resources/Public/JavaScripts/jquery-2.1.4.min.js" type="text/javascript"></script>
<script src="https://www.codesys.com/typo3conf/ext/template87/Resources/Public/JavaScripts/bootstrap.min.js" type="text/javascript"></script>
<script src="https://www.codesys.com/typo3conf/ext/solr/Resources/Public/JavaScript/JQuery/jquery.autocomplete.min.js" type="text/javascript"></script>
<script src="https://www.codesys.com/typo3conf/ext/template87/Resources/Public/JavaScripts/jquery.focuspoint.min.js" type="text/javascript"></script>
<script src="https://www.codesys.com/typo3conf/ext/template87/Resources/Public/JavaScripts/jquery.waypoints.min.js" type="text/javascript"></script>
<script src="https://www.codesys.com/typo3conf/ext/template87/Resources/Public/JavaScripts/helpME.js" type="text/javascript"></script>
<script src="https://www.codesys.com/typo3conf/ext/template87/Resources/Public/JavaScripts/custom.js" type="text/javascript"></script>
<script src="https://www.codesys.com/typo3conf/ext/template87/Resources/Public/JavaScripts/suggest_controller.js" type="text/javascript"></script>
</head>

<body class="wy-body-for-nav" role="document">
<header class="affix-top" id="headerWrapper">
    <div class="container">
        <div id="logoWrapper">
            <figure>
                <a href="/en/" target="_top">
                    <img alt="CODESYS GmbH" src="https://www.codesys.com/typo3conf/ext/template87/Resources/Public/Images/CODESYS-online-help-Logo.png">
                </a>
            </figure>
        </div>
        <div class="languageDropdownWrapper" id="wrapperlangMenuDesktop">
            <button aria-expanded="false" aria-haspopup="true" class="dropdown-toggle btn" data-toggle="dropdown" id="dropdownTogglelangMenuDesktop" type="button">
                <span id="LangID"></span>
                <span class="caret"></span>
            </button>
            <ul aria-labelledby="dropdownTogglelangMenuDesktop" class="dropdown-menu dropdownContentlangMenuDesktop">
                <li class="">
                    <a class="changeLangButton" href="#" hreflang="de">Deutsch</a>
                </li>
                <li class="">
                    <a class="changeLangButton" href="#" hreflang="en">English</a>
                </li>
                <li class="">
                    <a class="changeLangButton" href="#" hreflang="fr">Fran&ccedil;ais</a>
                </li>
                <li class="">
                    <a class="changeLangButton" href="#" hreflang="es">Espa&ntilde;ol</a>
                </li>
                <li class="">
                    <a class="changeLangButton" href="#" hreflang="it">Italiano</a>
                </li>
                <li class="">
                    <a class="changeLangButton" href="#" hreflang="ru">&#1056;&#1091;&#1089;&#1089;&#1082;&#1080;&#1081;</a>
                </li>
                <li class="">
                    <a class="changeLangButton" href="#" hreflang="ja">&#26085;&#26412;&#35486;</a>
                </li>
                <li class="">
                    <a class="changeLangButton" href="#" hreflang="zh-CHS">&#20013;&#25991;</a>
                </li>
            </ul>
        </div>
        <div class="" id="menuToggle">
            <span class="toggle-icon">
                <i class="zmdi zmdi-hc-2x zmdi-menu"></i>
            </span>
            <span class="toggle-label">Menu</span>
        </div>
        <div id="searchToggle">
            <span class="toggle-icon">
                <i class="zmdi zmdi-search zmdi-hc-2x"></i>
            </span>
            <span class="toggle-label">Search</span>
        </div>
        <div class="" id="siteSearch" style="display: none;">
            <form accept-charset="utf-8" action="https://www.helpme-codesys.com/search.html" class=""
                  data-suggest="https://www.helpme-codesys.com/?type=7384" data-suggest-header="Top Results"
                  enctype="multipart/form-data" method="get" name="searchbox">
                <div class="tx-indexedsearch-hidden-fields">
                    <input name="id" type="hidden" value="">
                </div>
                <div class="input-group">
                    <input autocomplete="off"
                           class="tx-solr-q js-solr-q tx-solr-suggest tx-solr-suggest-focus form-control"
                           name="tx_solr[q]"
                           placeholder="Search term" style="position: relative;" type="text">
                </div>
            </form>
        </div>
    </div>
    <nav id="mainMenuWrapper">
        <div id="mainNav">
            <div class="menu-layout-1 inactive" id="menuFlyout" style="height: 0px;">
                <div class="languageDropdownWrapper" id="wrapperlangMenuMobile">
                    <button aria-expanded="true" aria-haspopup="true" class="dropdown-toggle btn"
                            data-toggle="dropdown" id="dropdownTogglelangMenuMobile" type="button">
                        <span id="langIDMobile"></span>
                        <span class="caret"></span>
                    </button>
                    <ul aria-labelledby="dropdownTogglelangMenuMobile"
                        class="dropdown-menu dropdownContentlangMenuMobile">
                        <li class="">
                            <a class="changeLangButton" href="#" hreflang="de">Deutsch</a>
                        </li>
                        <li class="">
                            <a class="changeLangButton" href="#" hreflang="en">English</a>
                        </li>
                        <li class="">
                            <a class="changeLangButton" href="#" hreflang="fr">Fran&ccedil;ais</a>
                        </li>
                        <li class="">
                            <a class="changeLangButton" href="#" hreflang="es">Espa&ntilde;ol</a>
                        </li>
                        <li class="">
                            <a class="changeLangButton" href="#" hreflang="it">Italiano</a>
                        </li>
                        <li class="">
                            <a class="changeLangButton" href="#" hreflang="ru">&#1056;&#1091;&#1089;&#1089;&#1082;&#1080;&#1081;</a>
                        </li>
                        <li class="">
                            <a class="changeLangButton" href="#" hreflang="ja">&#26085;&#26412;&#35486;</a>
                        </li>
                        <li class="">
                            <a class="changeLangButton" href="#" hreflang="zh-CHS">&#20013;&#25991;</a>
                        </li>
                    </ul>
                </div>
                <div class="container">
                    <div class="menu-main">
                        <div id="menuRenderContainer" class="flex-menu">
                            <!-- ############### START Automatic Menu Rendering ################## -->
                            <!-- ############### END Automatic Menu Rendering ################## -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>
</header> 

    <div class="wy-grid-for-nav">

        
        <nav data-toggle="wy-nav-shift" class="wy-nav-side">
            <div class="wy-side-scroll">
                <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="concepts.html">Concepts and Elements</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="library_types.html">Library Types</a><ul>
<li class="toctree-l3"><a class="reference internal" href="library_types.html#common-libraries">Common Libraries</a></li>
<li class="toctree-l3"><a class="reference internal" href="library_types.html#container-libraries">Container Libraries</a></li>
<li class="toctree-l3"><a class="reference internal" href="library_types.html#interface-libraries">Interface Libraries</a></li>
<li class="toctree-l3"><a class="reference internal" href="library_types.html#end-user-libraries">End-User Libraries</a><ul>
<li class="toctree-l4"><a class="reference internal" href="lib_changes.html">How to change a library</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="placeholder.html">Placeholder</a></li>
<li class="toctree-l2"><a class="reference internal" href="prefix.html">Library Prefix</a></li>
<li class="toctree-l2"><a class="reference internal" href="categories.html">Library Categories</a></li>
<li class="toctree-l2"><a class="reference internal" href="properties.html">Library Properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="behaviour_model.html">Behaviour Model and Interface Design</a><ul>
<li class="toctree-l3"><a class="reference internal" href="behaviour_model.html#edge-triggered-function-blocks">Edge Triggered Function Blocks</a></li>
<li class="toctree-l3"><a class="reference internal" href="behaviour_model.html#level-controlled-function-blocks">Level Controlled Function Blocks</a></li>
<li class="toctree-l3"><a class="reference internal" href="behaviour_model.html#common-properties">Common properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="behaviour_model.html#timing-constraints">Timing constraints</a></li>
<li class="toctree-l3"><a class="reference internal" href="behaviour_model.html#error-handling">Error Handling</a></li>
<li class="toctree-l3"><a class="reference internal" href="behaviour_model.html#sorting-inputs-and-outputs">Sorting Inputs and Outputs</a></li>
<li class="toctree-l3"><a class="reference internal" href="behaviour_model.html#cooperation">Cooperation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="behaviour_model.html#tcp-reader-example">TCP Reader Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="behaviour_model.html#extending-the-example-to-a-complete-echoserver">Extending the Example to a Complete EchoServer</a></li>
<li class="toctree-l4"><a class="reference internal" href="behaviour_model.html#transformation-to-a-multithreaded-echoserver">Transformation to a Multithreaded EchoServer</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="behaviour_model.html#library-support">Library Support</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="static_analysis.html">Static Analysis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="static_analysis.html#plcopen-coding-guidelines">PLCopen - Coding Guidelines</a></li>
<li class="toctree-l3"><a class="reference internal" href="static_analysis.html#recommended-rules-for-static-analysis">Recommended Rules for Static Analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="var_input_constant.html">Parameterization with parameter lists</a><ul>
<li class="toctree-l3"><a class="reference internal" href="var_input_constant.html#library-parameters">Library parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="var_input_constant.html#declarative-parameterization-of-function-blocks">Declarative Parameterization of Function Blocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="parameters.html">Parameter Handling</a><ul>
<li class="toctree-l3"><a class="reference internal" href="parameters.html#var-input">VAR_INPUT</a></li>
<li class="toctree-l3"><a class="reference internal" href="parameters.html#var-input-constant">VAR_INPUT CONSTANT</a></li>
<li class="toctree-l3"><a class="reference internal" href="parameters.html#var-output">VAR_OUTPUT</a></li>
<li class="toctree-l3"><a class="reference internal" href="parameters.html#var-in-out">VAR_IN_OUT</a></li>
<li class="toctree-l3"><a class="reference internal" href="parameters.html#var-in-out-constant">VAR_IN_OUT CONSTANT</a></li>
<li class="toctree-l3"><a class="reference internal" href="parameters.html#consistency">Consistency</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="visibility.html">Visibility Control</a><ul>
<li class="toctree-l3"><a class="reference internal" href="visibility.html#attributes-for-controlling-the-visibility">Attributes for Controlling the Visibility</a></li>
<li class="toctree-l3"><a class="reference internal" href="visibility.html#keywords-for-controlling-the-visibility">Keywords for Controlling the Visibility</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="external.html">External Libraries</a><ul>
<li class="toctree-l3"><a class="reference internal" href="optional.html">Working with external optional Libraries</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="friends.html">Developers best friends</a><ul>
<li class="toctree-l3"><a class="reference internal" href="friends.html#specify-the-intended-use">Specify the intended use</a></li>
<li class="toctree-l3"><a class="reference internal" href="friends.html#identify">Identify your System</a></li>
<li class="toctree-l3"><a class="reference internal" href="friends.html#respond-to-specific-situations">Respond to specific Situations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="friends.html#example-and-demonstration">Example and Demonstration</a></li>
<li class="toctree-l4"><a class="reference internal" href="friends.html#helper-structures-for-generic-types">Helper Structures for Generic Types</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="advanced.html">Advanced Topicâs</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="date_time.html">Duration, Date and Time</a><ul>
<li class="toctree-l4"><a class="reference internal" href="date_time.html#duration">Duration</a></li>
<li class="toctree-l4"><a class="reference internal" href="date_time.html#date-and-time">Date and Time</a></li>
<li class="toctree-l4"><a class="reference internal" href="date_time.html#special-applications">Special Applications</a></li>
</ul>
</li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Application of the Memory Block Manager</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#pool-based-memory-management">Pool based memory management</a></li>
<li class="toctree-l4"><a class="reference internal" href="#application-and-management-of-messages">Application and management of messages</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="fb_factory.html">Dynamic Generation of FB Instances</a></li>
<li class="toctree-l3"><a class="reference internal" href="segmented_buffers.html">Segmented Buffers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="segmented_buffers.html#beispiele">Beispiele</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="synchronization.html">Synchronization of Concurrent Execution</a><ul>
<li class="toctree-l4"><a class="reference internal" href="synchronization.html#sema">SEMA</a></li>
<li class="toctree-l4"><a class="reference internal" href="synchronization.html#bolt">BOLT</a></li>
<li class="toctree-l4"><a class="reference internal" href="synchronization.html#task-lock">Task Lock</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="async.html">Asynchronous Job Execution</a><ul>
<li class="toctree-l4"><a class="reference internal" href="async.html#applications-in-codesys">Applications in CODESYS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="multicore.html">Multicore - Tools</a><ul>
<li class="toctree-l4"><a class="reference internal" href="multicore.html#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="multicore.html#example">Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="multicore.html#measurement">Measurement</a></li>
<li class="toctree-l4"><a class="reference internal" href="multicore.html#atomic-operations">Atomic Operations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="file_server.html">Providing libraries and device descriptions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="file_server.html#libraries">Libraries</a></li>
<li class="toctree-l4"><a class="reference internal" href="file_server.html#device-descriptions">Device Descriptions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="certificate.html">Usage of client certificates from an external certification authority</a><ul>
<li class="toctree-l4"><a class="reference internal" href="certificate.html#import-of-client-certificates-via-csr">Import of client certificates via CSR</a></li>
<li class="toctree-l4"><a class="reference internal" href="certificate.html#import-of-client-certificates-with-private-key">Import of client certificates with private key</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="guidelines.html">Guidelines for Library Development</a><ul>
<li class="toctree-l2"><a class="reference internal" href="filename.html">Select a meaningful filename</a></li>
<li class="toctree-l2"><a class="reference internal" href="namespaces.html">Select a pragmatic library namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="projectinfo.html">Enter all project information</a></li>
<li class="toctree-l2"><a class="reference internal" href="reuse.html">Apply the correct method for referencing other libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="interfaces.html">Design smart interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="errors.html">Implement user-friendly error handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="deployment.html">Use the correct method for deployment and licensing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="deployment.html#platform-vendor-dependent-usage-restriction">Platform-/vendor dependent usage restriction</a></li>
<li class="toctree-l3"><a class="reference internal" href="deployment.html#licensing-for-codesys-store">Licensing for CODESYS Store</a><ul>
<li class="toctree-l4"><a class="reference internal" href="deployment.html#engineering-license-via-codesys-security-key">Engineering-License via CODESYS Security Key</a></li>
<li class="toctree-l4"><a class="reference internal" href="deployment.html#engineering-license-via-soft-container">Engineering-License via Soft Container</a></li>
<li class="toctree-l4"><a class="reference internal" href="deployment.html#single-controller-license-via-cmpcodemeter">Single-Controller-License via CmpCodemeter</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="deployment.html#licensing-via-3slicense-library">Licensing via 3SLicense.library</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="templates.html">Ensure consistency by using templates</a><ul>
<li class="toctree-l3"><a class="reference internal" href="templates.html#template-types">Template Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="templates.html#function-blocks-design-patterns">Function Blocks Design Patterns</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="structure.html">Use a familiar and uniform project structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="varnames.html">Ensure clean code by applying a consistent naming conventions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="varnames.html#standard-data-types">Standard Data Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="varnames.html#scope-marker">Scope Marker</a></li>
<li class="toctree-l3"><a class="reference internal" href="varnames.html#safety-data-types">Safety Data Types</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="documentation.html">Library Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="docAreas.html">Documentation Areas</a><ul>
<li class="toctree-l3"><a class="reference internal" href="docAreas.html#project-information">Project Information</a></li>
<li class="toctree-l3"><a class="reference internal" href="docAreas.html#folder">Folder</a></li>
<li class="toctree-l3"><a class="reference internal" href="docAreas.html#declaration-header">Declaration Header</a></li>
<li class="toctree-l3"><a class="reference internal" href="docAreas.html#member-declaration">Member Declaration</a></li>
<li class="toctree-l3"><a class="reference internal" href="docAreas.html#enums-structures-gvl-s">Enums, Structures, GVLâs</a></li>
<li class="toctree-l3"><a class="reference internal" href="docAreas.html#actions-and-transitions">Actions and Transitions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="reSTOverview.html">Formatting Commands (Overview)</a></li>
<li class="toctree-l2"><a class="reference internal" href="reSTOverview.html#the-markup-specification">The Markup Specification</a></li>
<li class="toctree-l2"><a class="reference internal" href="reSTOverview.html#codesys-specific-formatting-commands">CODESYS Specific Formatting Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="install-win.html">Tool installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="install-win.html#installing-python-on-windows">Installing Python on Windows</a><ul>
<li class="toctree-l4"><a class="reference internal" href="install-win.html#setuptools">Setuptools</a></li>
<li class="toctree-l4"><a class="reference internal" href="install-win.html#pip">Pip</a></li>
<li class="toctree-l4"><a class="reference internal" href="install-win.html#virtualenv">Virtualenv</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="install-win.html#virtualenv-wrapper-optional">Virtualenv Wrapper (optional)</a></li>
<li class="toctree-l3"><a class="reference internal" href="install-win.html#notepad">Notepad++</a></li>
<li class="toctree-l3"><a class="reference internal" href="install-win.html#html-help-workshop">HTML Help Workshop</a></li>
<li class="toctree-l3"><a class="reference internal" href="install-win.html#tex-live-for-windows">TeX Live for Windows</a></li>
<li class="toctree-l3"><a class="reference internal" href="install-win.html#po-file-editor">PO File Editor</a></li>
<li class="toctree-l3"><a class="reference internal" href="install-win.html#microsoft-visual-c-compiler-for-python-2-7">Microsoft Visual C++ Compiler for Python 2.7</a></li>
<li class="toctree-l3"><a class="reference internal" href="install-win.html#mingw-compiler">MinGW Compiler</a></li>
<li class="toctree-l3"><a class="reference internal" href="install-win.html#libdoc-scripting-collection">LibDoc Scripting Collection</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="docScripting.html">Script your Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="styles.html">Page Layout Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="styles.html#templates">Templates</a></li>
<li class="toctree-l3"><a class="reference internal" href="styles.html#themes">Themes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="styles.html#themes-for-html-based-output">Themes for HTML-Based Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="styles.html#themes-for-pdf-output">Themes for PDF Output</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="outputs.html">Different Output Formats for Library Documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="outputs.html#html-output-format">HTML Output Format</a></li>
<li class="toctree-l3"><a class="reference internal" href="outputs.html#lmd-output-format">LMD Output Format</a></li>
<li class="toctree-l3"><a class="reference internal" href="outputs.html#chm-output-format">CHM Output Format</a></li>
<li class="toctree-l3"><a class="reference internal" href="outputs.html#pdf-output-format">PDF Output Format</a></li>
<li class="toctree-l3"><a class="reference internal" href="outputs.html#pot-output-format">POT Output Format</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="localization.html">Documentation in Different Languages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="localization.html#generating-translations">Generating Translations</a></li>
<li class="toctree-l3"><a class="reference internal" href="localization.html#deployment-of-translated-documents">Deployment of Translated Documents</a></li>
<li class="toctree-l3"><a class="reference internal" href="localization.html#workflow-for-localising-signed-libraries">Workflow for Localising Signed Libraries</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="documentation.html#examples-of-restructuredtext">Examples of âreStructuredTextâ</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="packages.html">Package Designer</a></li>
<li class="toctree-l1"><a class="reference internal" href="checklist.html">Library Development Checklist</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>

            
          
                </div>
            </div>
        </nav>

        <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
            
            <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
                <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
                <a href="index.html">CODESYS LibDevSummary</a>
            </nav>


            
            <div class="wy-nav-content">
                <div class="rst-content">
                    

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
          <li><a href="concepts.html">Concepts and Elements</a> &raquo;</li>
      
          <li><a href="advanced.html">Advanced Topicâs</a> &raquo;</li>
      
    <li>Application of the Memory Block Manager</li>
  </ul>
  <hr/>
</div>
                    <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
                        <div itemprop="articleBody">
                            
  <section id="application-of-the-memory-block-manager">
<span id="mem-block-man"></span><h1>Application of the Memory Block Manager<a class="headerlink" href="#application-of-the-memory-block-manager" title="Permalink to this heading">Â¶</a></h1>
<p>The functions of this library (Memory Block Manager, CODESYS, 3.5.20.0) are largely implemented in the runtime system
and should not be called directly by the end user.
However, when they are well encapsulated in function blocks, they are useful for the development of function block
libraries that are convenient to work with.</p>
<section id="pool-based-memory-management">
<h2>Pool based memory management<a class="headerlink" href="#pool-based-memory-management" title="Permalink to this heading">Â¶</a></h2>
<p>There are many advantages to working with a pool of equally sized blocks.</p>
<ul class="simple">
<li><p>The calls for the request (<code class="docutils literal notranslate"><span class="pre">PoolGetBlock</span></code>) and release (<code class="docutils literal notranslate"><span class="pre">PoolPutBlock</span></code>) of the blocks can be implemented
in a very efficient way with a constant effort.</p></li>
<li><p>The operating system (<code class="docutils literal notranslate"><span class="pre">Malloc</span></code>/<code class="docutils literal notranslate"><span class="pre">Free</span></code>) does not have to be in use for this purpose.</p></li>
<li><p>There is no risk of memory fragmentation.</p></li>
<li><p>Synchronization of the various calls in multitasking or multicore environments is guaranteed.</p></li>
</ul>
<p>The functions for creating, extending (<code class="docutils literal notranslate"><span class="pre">PoolCreateH</span></code>/<code class="docutils literal notranslate"><span class="pre">PoolExtendH</span></code>) or destroying (<code class="docutils literal notranslate"><span class="pre">PoolDelete</span></code>) a pool
require the memory management (<code class="docutils literal notranslate"><span class="pre">Malloc</span></code>/<code class="docutils literal notranslate"><span class="pre">Free</span></code>) of the operating system
and should therefore be called in an appropriate context (<code class="docutils literal notranslate"><span class="pre">call_after_init</span></code> / <code class="docutils literal notranslate"><span class="pre">BackgroundTask</span></code>)
so that they do not interfere with the cycle time of the PLC.</p>
<p>The order in which the pool and its blocks are released is not easy to maintain (see: <code class="docutils literal notranslate"><span class="pre">FB_Exit</span></code>).
For this reason, calling <code class="docutils literal notranslate"><span class="pre">PoolDelete</span></code> does not delete the pool, it just locks it.
Calls to <code class="docutils literal notranslate"><span class="pre">PoolGetBlock</span></code> and <code class="docutils literal notranslate"><span class="pre">PoolExtendH</span></code> will therefore return errors.
Only after the last call to <code class="docutils literal notranslate"><span class="pre">PoolPutBlock</span></code> will the resources of the pool be released.</p>
<section id="setup-a-block-pool">
<h3>Setup a Block Pool<a class="headerlink" href="#setup-a-block-pool" title="Permalink to this heading">Â¶</a></h3>
<p>There are two options for setting up a pool.</p>
<p>1.) From âstaticâ memory with <code class="docutils literal notranslate"><span class="pre">PoolCreateP</span></code></p>
<blockquote>
<div><div class="highlight-codesys notranslate"><div class="highlight"><pre><span></span><span class="k">TYPE</span> <span class="n">DATA</span> <span class="p">:</span>
<span class="k">STRUCT</span>
    <span class="cm">(* ... some members ...*)</span>
<span class="k">END_STRUCT</span>
<span class="k">END_TYPE</span>

<span class="c1">// SIZEOF(DATA) should be a multiple of SIZEOF(__XWORD)</span>
<span class="c1">// =&gt; ((SIZEOF(DATA) + SIZEOF(__XWORD) - 1) / SIZEOF(__XWORD)) * SIZEOF(__XWORD)</span>
<span class="c1">// n =&gt; Number of blocks</span>
<span class="c1">// m =&gt; Number of __XWORD entries in axwPoolMem</span>
<span class="c1">// m := MBM.PoolGetSize(n, SIZEOF(DATA)) / SIZEOF(__XWORD) + 1;</span>

<span class="n">axwPoolMem</span> <span class="p">:</span> <span class="k">ARRAY</span><span class="l">[0..(m-1)]</span> <span class="k">OF</span> <span class="kt">__XWORD</span><span class="p">;</span> <span class="c1">// Initial memory area for the pool (__XWORD aligned)</span>
<span class="n">hPool</span> <span class="p">:</span> <span class="n">MBM.HANDLE</span><span class="p">;</span>
<span class="n">eError</span> <span class="p">:</span> <span class="n">MBM.ERROR</span><span class="p">;</span>

<span class="n">hPool</span> <span class="p">:=</span> <span class="n">MBM.PoolCreateP</span><span class="p">(</span>
    <span class="n">szBlockSize</span><span class="p">:=</span><span class="k">SIZEOF</span><span class="p">(</span><span class="n">DATA</span><span class="p">),</span>
    <span class="n">szMemSize</span><span class="p">:=</span><span class="k">SIZEOF</span><span class="p">(</span><span class="n">axwPoolMem</span><span class="p">),</span>
    <span class="n">pMemory</span><span class="p">:=</span><span class="k">ADR</span><span class="p">(</span><span class="n">axwPoolMem</span><span class="p">),</span>
    <span class="n">peError</span><span class="p">:=</span><span class="k">ADR</span><span class="p">(</span><span class="n">eError</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>2.) From âdynamicâ memory with <code class="docutils literal notranslate"><span class="pre">PoolCreateH</span></code></p>
<blockquote>
<div><div class="highlight-codesys notranslate"><div class="highlight"><pre><span></span><span class="k">TYPE</span> <span class="n">DATA</span> <span class="p">:</span>
<span class="k">STRUCT</span>
    <span class="cm">(* ... some members ...*)</span>
<span class="k">END_STRUCT</span>
<span class="k">END_TYPE</span>

<span class="c1">// n =&gt; Number of blocks</span>

<span class="n">hPool</span> <span class="p">:</span> <span class="n">MBM.HANDLE</span><span class="p">;</span>
<span class="n">eError</span> <span class="p">:</span> <span class="n">MBM.ERROR</span><span class="p">;</span>

<span class="n">hPool</span> <span class="p">:=</span> <span class="n">MBM.PoolCreateH</span><span class="p">(</span>
    <span class="n">ctNumBlocks</span><span class="p">:=</span><span class="n">n</span><span class="p">,</span>
    <span class="n">szBlockSize</span><span class="p">:=</span><span class="k">SIZEOF</span><span class="p">(</span><span class="n">DATA</span><span class="p">),</span>
    <span class="n">peError</span><span class="p">:=</span><span class="k">ADR</span><span class="p">(</span><span class="n">eError</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="managing-memory-blocks">
<h3>Managing memory blocks<a class="headerlink" href="#managing-memory-blocks" title="Permalink to this heading">Â¶</a></h3>
<p>1.) Requesting a block with <code class="docutils literal notranslate"><span class="pre">PoolGetBlock</span></code></p>
<blockquote>
<div><div class="highlight-codesys notranslate"><div class="highlight"><pre><span></span><span class="n">hPool</span> <span class="p">:</span> <span class="n">MBM.HANDLE</span><span class="p">;</span>
<span class="n">eError</span> <span class="p">:</span> <span class="n">MBM.ERROR</span><span class="p">;</span>
<span class="n">pBLock</span> <span class="p">:</span> <span class="k">POINTER</span> <span class="k">TO</span> <span class="n">DATA</span><span class="p">;</span>

<span class="n">pBlock</span> <span class="p">:=</span> <span class="n">MBM.PoolGetBlock</span><span class="p">(</span><span class="n">hPool</span><span class="p">:=</span><span class="n">hPool</span><span class="p">,</span> <span class="n">peError</span><span class="p">:=</span><span class="k">ADR</span><span class="p">(</span><span class="n">eError</span><span class="p">));</span>
<span class="k">IF</span> <span class="n">pBlock</span> <span class="p">&lt;&gt;</span> <span class="mi">0</span> <span class="k">THEN</span>
    <span class="cm">(* ... work with the new block ... *)</span>
    <span class="c1">// optional, regenerate hPool from pBlock</span>
    <span class="n">hPool</span> <span class="p">:=</span> <span class="n">MBM.BlockGetPool</span><span class="p">(</span><span class="n">hBlock</span><span class="p">:=</span><span class="n">pBlock</span><span class="p">,</span> <span class="n">peError</span><span class="p">:=</span><span class="k">ADR</span><span class="p">(</span><span class="n">eError</span><span class="p">));</span>
<span class="k">END_IF</span>
</pre></div>
</div>
</div></blockquote>
<p>2.) Release a block with <code class="docutils literal notranslate"><span class="pre">PoolPutBlock</span></code></p>
<blockquote>
<div><div class="highlight-codesys notranslate"><div class="highlight"><pre><span></span><span class="n">eError</span> <span class="p">:</span> <span class="n">MBM.ERROR</span><span class="p">;</span>
<span class="n">pBLock</span> <span class="p">:</span> <span class="k">POINTER</span> <span class="k">TO</span> <span class="n">DATA</span><span class="p">;</span>

<span class="n">eError</span> <span class="p">:=</span> <span class="n">MBM.PoolPutBlock</span><span class="p">(</span><span class="n">hBlock</span><span class="p">:=</span><span class="n">pBlock</span><span class="p">);</span>
<span class="n">pBlock</span> <span class="p">:=</span> <span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="extending-a-block-pool">
<h3>Extending a block pool<a class="headerlink" href="#extending-a-block-pool" title="Permalink to this heading">Â¶</a></h3>
<blockquote>
<div><div class="highlight-codesys notranslate"><div class="highlight"><pre><span></span><span class="n">hPool</span> <span class="p">:</span> <span class="n">MBM.HANDLE</span><span class="p">;</span>
<span class="n">eError</span> <span class="p">:</span> <span class="n">MBM.ERROR</span><span class="p">;</span>
<span class="n">xExtend</span> <span class="p">:</span> <span class="kt">BOOL</span><span class="p">;</span>

<span class="k">IF</span> <span class="n">xExtend</span> <span class="k">THEN</span>
    <span class="c1">// block pool is exhausted</span>
    <span class="c1">// extend block pool from heap</span>
    <span class="n">eError</span> <span class="p">:=</span> <span class="n">MBM.PoolExtendH</span><span class="p">(</span><span class="n">hPool</span><span class="p">:=</span><span class="n">hPool</span><span class="p">,</span> <span class="n">ctNumBlocks</span><span class="p">:=</span><span class="n">n</span><span class="p">);</span>
    <span class="n">xExtend</span> <span class="p">:=</span> <span class="kc">FALSE</span><span class="p">;</span>
<span class="k">END_IF</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="destroying-a-block-pool">
<h3>Destroying a block pool<a class="headerlink" href="#destroying-a-block-pool" title="Permalink to this heading">Â¶</a></h3>
<blockquote>
<div><div class="highlight-codesys notranslate"><div class="highlight"><pre><span></span><span class="n">hPool</span> <span class="p">:</span> <span class="n">MBM.HANDLE</span><span class="p">;</span>
<span class="n">eError</span> <span class="p">:</span> <span class="n">MBM.ERROR</span><span class="p">;</span>
<span class="n">xExit</span> <span class="p">:</span> <span class="kt">BOOL</span><span class="p">;</span>

<span class="k">IF</span> <span class="n">xExit</span> <span class="k">THEN</span>
    <span class="n">eError</span> <span class="p">:=</span> <span class="n">MBM.PoolDelete</span><span class="p">(</span><span class="n">hPool</span><span class="p">:=</span><span class="n">hPool</span><span class="p">);</span>
    <span class="c1">// The pool is now locked and PoolGetBlock will return an error</span>
    <span class="c1">// The pool memory will be released with the last PoolPutBlock</span>
    <span class="n">hPool</span> <span class="p">:=</span> <span class="n">MBM.gc_hINVALID</span><span class="p">;</span>
    <span class="n">xExit</span> <span class="p">:=</span> <span class="kc">FALSE</span><span class="p">;</span>
<span class="k">END_IF</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="query-the-current-state-of-a-block-pool">
<h3>Query the current state of a block pool<a class="headerlink" href="#query-the-current-state-of-a-block-pool" title="Permalink to this heading">Â¶</a></h3>
<blockquote>
<div><div class="highlight-codesys notranslate"><div class="highlight"><pre><span></span><span class="n">hPool</span> <span class="p">:</span> <span class="n">MBM.HANDLE</span><span class="p">;</span>
<span class="n">eError</span> <span class="p">:</span> <span class="n">MBM.ERROR</span><span class="p">;</span>
<span class="n">xQuery</span> <span class="p">:</span> <span class="kt">BOOL</span><span class="p">;</span>

<span class="n">udiSize</span><span class="p">,</span> <span class="n">udiCapacity</span><span class="p">,</span> <span class="n">udiCount</span> <span class="p">:</span> <span class="kt">UDINT</span><span class="p">;</span>

<span class="k">IF</span> <span class="n">xQuery</span> <span class="k">THEN</span>
    <span class="n">udiSize</span> <span class="p">:=</span> <span class="n">TO_UDINT</span><span class="p">(</span><span class="n">MBM.PoolGetBlockSize</span><span class="p">(</span><span class="n">hPool</span><span class="p">:=</span><span class="n">hPool</span><span class="p">,</span> <span class="n">peError</span><span class="p">:=</span><span class="k">ADR</span><span class="p">(</span><span class="n">eError</span><span class="p">));</span>
    <span class="n">udiCapacity</span> <span class="p">:=</span> <span class="n">TO_UDINT</span><span class="p">(</span><span class="n">MBM.PoolGetCurCapacity</span><span class="p">(</span><span class="n">hPool</span><span class="p">:=</span><span class="n">hPool</span><span class="p">,</span> <span class="n">peError</span><span class="p">:=</span><span class="k">ADR</span><span class="p">(</span><span class="n">eError</span><span class="p">));</span>
    <span class="n">udiCount</span> <span class="p">:=</span> <span class="n">TO_UDINT</span><span class="p">(</span><span class="n">MBM.PoolGetNumBlocksLeft</span><span class="p">(</span><span class="n">hPool</span><span class="p">:=</span><span class="n">hPool</span><span class="p">,</span> <span class="n">peError</span><span class="p">:=</span><span class="k">ADR</span><span class="p">(</span><span class="n">eError</span><span class="p">));</span>
    <span class="n">xQuery</span> <span class="p">:=</span> <span class="kc">FALSE</span><span class="p">;</span>
<span class="k">END_IF</span>
</pre></div>
</div>
</div></blockquote>
</section>
</section>
<section id="application-and-management-of-messages">
<h2>Application and management of messages<a class="headerlink" href="#application-and-management-of-messages" title="Permalink to this heading">Â¶</a></h2>
<p>What we said about block pools applies equally to message pools.</p>
<p>Messages are typically used to connect different tasks.
A first task, the producer, uses a message pool and takes messages from it and sends them to the queue of a second task,
the consumer. The consumer task takes the message from the queue and processes it.
After processing, the message is sent back to the pool.
The two tasks can operate independently of each other through this cycle, with peak loads being balanced by the queue.</p>
<p>A queue can handle between 1 (highest) and 64 (lowest) priority levels.
The exact number of priority levels for a specific queue is defined with the function <code class="docutils literal notranslate"><span class="pre">XChgCreateP</span></code> / <code class="docutils literal notranslate"><span class="pre">XChgCreateH</span></code>.
The producer assigns a priority to each message.
The consumer receives the message with the highest priority on a first in/first out basis.
This allows a high priority message to overtake a low priority message.</p>
<p>A queue can process messages from different pools.
For example, different types of messages can be used.</p>
<section id="setup-a-message-pool">
<h3>Setup a Message Pool<a class="headerlink" href="#setup-a-message-pool" title="Permalink to this heading">Â¶</a></h3>
<p>There are two options for setting up a message pool.</p>
<p>1.) From âstaticâ memory with <code class="docutils literal notranslate"><span class="pre">XChgCreateP</span></code></p>
<blockquote>
<div><div class="highlight-codesys notranslate"><div class="highlight"><pre><span></span><span class="k">TYPE</span> <span class="n">DATA</span> <span class="p">:</span>
<span class="k">STRUCT</span>
    <span class="cm">(* ... some members ...*)</span>
<span class="k">END_STRUCT</span>
<span class="k">END_TYPE</span>

<span class="c1">// SIZEOF(DATA) should be a multiple of SIZEOF(__XWORD)</span>
<span class="c1">// =&gt; ((SIZEOF(DATA) + SIZEOF(__XWORD) - 1) / SIZEOF(__XWORD)) * SIZEOF(__XWORD)</span>
<span class="c1">// n =&gt; Number of messages</span>
<span class="c1">// m =&gt; Number of __XWORD entries in axwPoolMem</span>
<span class="c1">// m := MBM.XChgGetSize(n, SIZEOF(DATA), 0) / SIZEOF(__XWORD) + 1;</span>

<span class="n">axwPoolMem</span> <span class="p">:</span> <span class="k">ARRAY</span><span class="l">[0..(m-1)]</span> <span class="k">OF</span> <span class="kt">__XWORD</span><span class="p">;</span> <span class="c1">// Initial memory area for the pool (__XWORD aligned)</span>
<span class="n">hPool</span> <span class="p">:</span> <span class="n">MBM.HANDLE</span><span class="p">;</span>
<span class="n">eError</span> <span class="p">:</span> <span class="n">MBM.ERROR</span><span class="p">;</span>

<span class="n">hPool</span> <span class="p">:=</span> <span class="n">MBM.XChgCreateP</span><span class="p">(</span>
    <span class="n">szBlockSize</span><span class="p">:=</span><span class="k">SIZEOF</span><span class="p">(</span><span class="n">DATA</span><span class="p">),</span>
    <span class="n">ctNumPrios</span><span class="p">:=</span><span class="mi">0</span><span class="p">,</span> <span class="cm">(* !! *)</span>
    <span class="n">szMemSize</span><span class="p">:=</span><span class="k">SIZEOF</span><span class="p">(</span><span class="n">axwPoolMem</span><span class="p">),</span>
    <span class="n">pMemory</span><span class="p">:=</span><span class="k">ADR</span><span class="p">(</span><span class="n">axwPoolMem</span><span class="p">),</span>
    <span class="n">peError</span><span class="p">:=</span><span class="k">ADR</span><span class="p">(</span><span class="n">eError</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>2.) From âdynamicâ memory with <code class="docutils literal notranslate"><span class="pre">XChgCreateH</span></code></p>
<blockquote>
<div><div class="highlight-codesys notranslate"><div class="highlight"><pre><span></span><span class="k">TYPE</span> <span class="n">DATA</span> <span class="p">:</span>
<span class="k">STRUCT</span>
    <span class="cm">(* ... some members ...*)</span>
<span class="k">END_STRUCT</span>
<span class="k">END_TYPE</span>

<span class="c1">// n =&gt; Number of messages</span>

<span class="n">hPool</span> <span class="p">:</span> <span class="n">MBM.HANDLE</span><span class="p">;</span>
<span class="n">eError</span> <span class="p">:</span> <span class="n">MBM.ERROR</span><span class="p">;</span>

<span class="n">hPool</span> <span class="p">:=</span> <span class="n">MBM.XChgCreateH</span><span class="p">(</span>
    <span class="n">ctNumMsg</span><span class="p">:=</span><span class="n">n</span><span class="p">,</span>
    <span class="n">szBlockSize</span><span class="p">:=</span><span class="k">SIZEOF</span><span class="p">(</span><span class="n">DATA</span><span class="p">),</span>
    <span class="n">ctNumPrios</span><span class="p">:=</span><span class="mi">0</span><span class="p">,</span> <span class="cm">(* !! *)</span>
    <span class="n">peError</span><span class="p">:=</span><span class="k">ADR</span><span class="p">(</span><span class="n">eError</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="setup-a-message-queue">
<h3>Setup a Message Queue<a class="headerlink" href="#setup-a-message-queue" title="Permalink to this heading">Â¶</a></h3>
<p>There are two options for setting up a message queue.</p>
<p>1.) From âstaticâ memory with <code class="docutils literal notranslate"><span class="pre">XChgCreateP</span></code></p>
<blockquote>
<div><div class="highlight-codesys notranslate"><div class="highlight"><pre><span></span><span class="c1">// m =&gt; Number of __XWORD entries in axwQueueMem</span>
<span class="c1">// p =&gt; Number of priority levels (1..64)</span>
<span class="c1">// m := MBM.XChgGetSize(0, 0, p) / SIZEOF(__XWORD) + 1;</span>

<span class="n">axwQueueMem</span> <span class="p">:</span> <span class="k">ARRAY</span><span class="l">[0..(m-1)]</span> <span class="k">OF</span> <span class="kt">__XWORD</span><span class="p">;</span> <span class="c1">// Initial memory area for the queue (__XWORD aligned)</span>
<span class="n">hQueue</span> <span class="p">:</span> <span class="n">MBM.HANDLE</span><span class="p">;</span>
<span class="n">eError</span> <span class="p">:</span> <span class="n">MBM.ERROR</span><span class="p">;</span>

<span class="n">hQueue</span> <span class="p">:=</span> <span class="n">MBM.XChgCreateP</span><span class="p">(</span>
    <span class="n">szBlockSize</span><span class="p">:=</span><span class="mi">0</span><span class="p">,</span> <span class="cm">(* !! *)</span>
    <span class="n">ctNumPrios</span><span class="p">:=</span><span class="n">p</span><span class="p">,</span>
    <span class="n">szMemSize</span><span class="p">:=</span><span class="k">SIZEOF</span><span class="p">(</span><span class="n">axwQueueMem</span><span class="p">),</span>
    <span class="n">pMemory</span><span class="p">:=</span><span class="k">ADR</span><span class="p">(</span><span class="n">axwQueueMem</span><span class="p">),</span>
    <span class="n">peError</span><span class="p">:=</span><span class="k">ADR</span><span class="p">(</span><span class="n">eError</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>2.) From âdynamicâ memory with <code class="docutils literal notranslate"><span class="pre">XChgCreateH</span></code></p>
<blockquote>
<div><div class="highlight-codesys notranslate"><div class="highlight"><pre><span></span><span class="c1">// p =&gt; Number of priority levels (1..64)</span>

<span class="n">hQueue</span> <span class="p">:</span> <span class="n">MBM.HANDLE</span><span class="p">;</span>
<span class="n">eError</span> <span class="p">:</span> <span class="n">MBM.ERROR</span><span class="p">;</span>

<span class="n">hQueue</span> <span class="p">:=</span> <span class="n">MBM.XChgCreateH</span><span class="p">(</span>
    <span class="n">ctNumMsg</span><span class="p">:=</span><span class="mi">0</span><span class="p">,</span> <span class="cm">(* !! *)</span>
    <span class="n">szBlockSize</span><span class="p">:=</span><span class="mi">0</span><span class="p">,</span> <span class="cm">(* !! *)</span>
    <span class="n">ctNumPrios</span><span class="p">:=</span><span class="n">p</span><span class="p">,</span>
    <span class="n">peError</span><span class="p">:=</span><span class="k">ADR</span><span class="p">(</span><span class="n">eError</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="managing-messages">
<h3>Managing messages<a class="headerlink" href="#managing-messages" title="Permalink to this heading">Â¶</a></h3>
<p>1.) Requesting a message out of a message pool with <code class="docutils literal notranslate"><span class="pre">MsgReceive</span></code></p>
<blockquote>
<div><div class="highlight-codesys notranslate"><div class="highlight"><pre><span></span><span class="n">hPool</span> <span class="p">:</span> <span class="n">MBM.HANDLE</span><span class="p">;</span>
<span class="n">eError</span> <span class="p">:</span> <span class="n">MBM.ERROR</span><span class="p">;</span>
<span class="n">pMessage</span> <span class="p">:</span> <span class="k">POINTER</span> <span class="k">TO</span> <span class="n">DATA</span><span class="p">;</span>
<span class="n">ctMsgLeft</span> <span class="p">:</span> <span class="n">MBM.COUNT</span><span class="p">;</span> <span class="cm">(* !! *)</span>

<span class="n">pMessage</span> <span class="p">:=</span> <span class="n">MBM.MsgReceive</span><span class="p">(</span><span class="n">hXChg</span><span class="p">:=</span><span class="n">hPool</span><span class="p">,</span> <span class="n">pctMsgLeft</span><span class="p">:=</span><span class="k">ADR</span><span class="p">(</span><span class="n">ctMsgLeft</span><span class="p">),</span> <span class="n">peError</span><span class="p">:=</span><span class="k">ADR</span><span class="p">(</span><span class="n">eError</span><span class="p">));</span>
<span class="k">IF</span> <span class="n">pMessage</span> <span class="p">&lt;&gt;</span> <span class="mi">0</span> <span class="k">THEN</span>
    <span class="cm">(* ... work with the new message ... *)</span>
    <span class="c1">// optional, regenerate hPool from pMessage</span>
    <span class="n">hPool</span> <span class="p">:=</span> <span class="n">MBM.MsgGetRXChg</span><span class="p">(</span><span class="n">hMsg</span><span class="p">:=</span><span class="n">pMessage</span><span class="p">,</span> <span class="n">peError</span><span class="p">:=</span><span class="k">ADR</span><span class="p">(</span><span class="n">eError</span><span class="p">));</span>
<span class="k">END_IF</span>
</pre></div>
</div>
</div></blockquote>
<p>2.) Release a message back to its pool with <code class="docutils literal notranslate"><span class="pre">MsgRelease</span></code></p>
<blockquote>
<div><div class="highlight-codesys notranslate"><div class="highlight"><pre><span></span><span class="n">eError</span> <span class="p">:</span> <span class="n">MBM.ERROR</span><span class="p">;</span>
<span class="n">pMessage</span> <span class="p">:</span> <span class="k">POINTER</span> <span class="k">TO</span> <span class="n">DATA</span><span class="p">;</span>

<span class="n">eError</span> <span class="p">:=</span> <span class="n">MBM.MsgRelease</span><span class="p">(</span><span class="n">hMsg</span><span class="p">:=</span><span class="n">pMessage</span><span class="p">);</span>
<span class="n">pMessage</span> <span class="p">:=</span> <span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<p>3.) Requesting a message out of a message queue with <code class="docutils literal notranslate"><span class="pre">MsgReceive</span></code></p>
<blockquote>
<div><div class="highlight-codesys notranslate"><div class="highlight"><pre><span></span><span class="n">hQueue</span> <span class="p">:</span> <span class="n">MBM.HANDLE</span><span class="p">;</span>
<span class="n">eError</span> <span class="p">:</span> <span class="n">MBM.ERROR</span><span class="p">;</span>
<span class="n">pMessage</span> <span class="p">:</span> <span class="k">POINTER</span> <span class="k">TO</span> <span class="n">DATA</span><span class="p">;</span>
<span class="n">ctMsgLeft</span> <span class="p">:</span> <span class="n">MBM.COUNT</span><span class="p">;</span> <span class="cm">(* !! *)</span>

<span class="n">pMessage</span> <span class="p">:=</span> <span class="n">MBM.MsgReceive</span><span class="p">(</span><span class="n">hXChg</span><span class="p">:=</span><span class="n">hQueue</span><span class="p">,</span> <span class="n">pctMsgLeft</span><span class="p">:=</span><span class="k">ADR</span><span class="p">(</span><span class="n">ctMsgLeft</span><span class="p">),</span> <span class="n">peError</span><span class="p">:=</span><span class="k">ADR</span><span class="p">(</span><span class="n">eError</span><span class="p">));</span>
<span class="k">IF</span> <span class="n">pMessage</span> <span class="p">&lt;&gt;</span> <span class="mi">0</span> <span class="k">THEN</span>
    <span class="cm">(* ... work with the new message ... *)</span>
    <span class="n">MBM.MsgRelease</span><span class="p">(</span><span class="n">hMsg</span><span class="p">:=</span><span class="n">pMessage</span><span class="p">);</span>
    <span class="n">pMessage</span> <span class="p">:=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">END_IF</span>
</pre></div>
</div>
</div></blockquote>
<p>4.) Sending a message to a message queue with <code class="docutils literal notranslate"><span class="pre">MsgSend</span></code></p>
<blockquote>
<div><div class="highlight-codesys notranslate"><div class="highlight"><pre><span></span><span class="n">hQueue</span> <span class="p">:</span> <span class="n">MBM.HANDLE</span><span class="p">;</span>
<span class="n">eError</span> <span class="p">:</span> <span class="n">MBM.ERROR</span><span class="p">;</span>
<span class="n">pMessage</span> <span class="p">:</span> <span class="k">POINTER</span> <span class="k">TO</span> <span class="n">DATA</span><span class="p">;</span>
<span class="n">usiPrio</span> <span class="p">:</span> <span class="kt">USINT</span><span class="p">(</span><span class="mi">1</span><span class="p">..</span><span class="mi">64</span><span class="p">);</span>

<span class="n">eError</span> <span class="p">:=</span> <span class="n">MBM.MsgSend</span><span class="p">(</span><span class="n">hMsg</span><span class="p">:=</span><span class="n">pMessage</span><span class="p">,</span> <span class="n">usiPrio</span><span class="p">:=</span><span class="n">usiPrio</span><span class="p">,</span> <span class="n">hXChg</span><span class="p">:=</span><span class="n">hQueue</span><span class="p">);</span>
<span class="k">IF</span> <span class="n">eError</span> <span class="p">&lt;&gt;</span> <span class="n">MBM.ERROR.NO_ERROR</span> <span class="k">THEN</span>
    <span class="n">MBM.MsgRelease</span><span class="p">(</span><span class="n">hMsg</span><span class="p">:=</span><span class="n">pMessage</span><span class="p">);</span>
    <span class="n">pMessage</span> <span class="p">:=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">END_IF</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="extending-a-message-pool">
<h3>Extending a message pool<a class="headerlink" href="#extending-a-message-pool" title="Permalink to this heading">Â¶</a></h3>
<blockquote>
<div><div class="highlight-codesys notranslate"><div class="highlight"><pre><span></span><span class="n">hPool</span> <span class="p">:</span> <span class="n">MBM.HANDLE</span><span class="p">;</span>
<span class="n">eError</span> <span class="p">:</span> <span class="n">MBM.ERROR</span><span class="p">;</span>
<span class="n">xExtend</span> <span class="p">:</span> <span class="kt">BOOL</span><span class="p">;</span>

<span class="k">IF</span> <span class="n">xExtend</span> <span class="k">THEN</span>
    <span class="c1">// message pool is exhausted</span>
    <span class="c1">// extend message pool from heap</span>
    <span class="n">eError</span> <span class="p">:=</span> <span class="n">MBM.XChgExtendH</span><span class="p">(</span><span class="n">hXChg</span><span class="p">:=</span><span class="n">hPool</span><span class="p">,</span> <span class="n">ctNumMsg</span><span class="p">:=</span><span class="n">n</span><span class="p">);</span>
    <span class="n">xExtend</span> <span class="p">:=</span> <span class="kc">FALSE</span><span class="p">;</span>
<span class="k">END_IF</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="destroying-a-message-pool">
<h3>Destroying a message pool<a class="headerlink" href="#destroying-a-message-pool" title="Permalink to this heading">Â¶</a></h3>
<blockquote>
<div><div class="highlight-codesys notranslate"><div class="highlight"><pre><span></span><span class="n">hPool</span> <span class="p">:</span> <span class="n">MBM.HANDLE</span><span class="p">;</span>
<span class="n">xExit</span> <span class="p">:</span> <span class="kt">BOOL</span><span class="p">;</span>

<span class="k">IF</span> <span class="n">xExit</span> <span class="k">THEN</span>
    <span class="n">MBM.XChgDelete</span><span class="p">(</span><span class="n">hXChg</span><span class="p">:=</span><span class="n">hPool</span><span class="p">);</span>
    <span class="c1">// The pool is now locked and MsgReceive will return an error</span>
    <span class="c1">// The pool memory will be released with the last MsgRelease</span>
    <span class="n">hPool</span> <span class="p">:=</span> <span class="n">MBM.gc_hINVALID</span><span class="p">;</span>
    <span class="n">xExit</span> <span class="p">:=</span> <span class="kc">FALSE</span><span class="p">;</span>
<span class="k">END_IF</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="destroying-a-message-queue">
<h3>Destroying a message queue<a class="headerlink" href="#destroying-a-message-queue" title="Permalink to this heading">Â¶</a></h3>
<blockquote>
<div><div class="highlight-codesys notranslate"><div class="highlight"><pre><span></span><span class="n">hQueue</span> <span class="p">:</span> <span class="n">MBM.HANDLE</span><span class="p">;</span>
<span class="n">pMessage</span> <span class="p">:</span> <span class="k">POINTER</span> <span class="k">TO</span> <span class="kt">BYTE</span><span class="p">;</span>
<span class="n">xExit</span> <span class="p">:</span> <span class="kt">BOOL</span><span class="p">;</span>

<span class="k">IF</span> <span class="n">xExit</span> <span class="k">THEN</span>
    <span class="c1">// Any messages still in the queue are released</span>
    <span class="n">MBM.XChgDelete</span><span class="p">(</span><span class="n">hXChg</span><span class="p">:=</span><span class="n">hQueue</span><span class="p">);</span>
    <span class="n">hQueue</span> <span class="p">:=</span> <span class="n">MBM.gc_hINVALID</span><span class="p">;</span>
    <span class="n">xExit</span> <span class="p">:=</span> <span class="kc">FALSE</span><span class="p">;</span>
<span class="k">END_IF</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="query-the-current-state-of-a-message-pool">
<h3>Query the current state of a message pool<a class="headerlink" href="#query-the-current-state-of-a-message-pool" title="Permalink to this heading">Â¶</a></h3>
<blockquote>
<div><div class="highlight-codesys notranslate"><div class="highlight"><pre><span></span><span class="n">hPool</span> <span class="p">:</span> <span class="n">MBM.HANDLE</span><span class="p">;</span>
<span class="n">eError</span> <span class="p">:</span> <span class="n">MBM.ERROR</span><span class="p">;</span>
<span class="n">xQuery</span> <span class="p">:</span> <span class="kt">BOOL</span><span class="p">;</span>

<span class="n">udiSize</span><span class="p">,</span> <span class="n">udiCapacity</span><span class="p">,</span> <span class="n">udiCount</span> <span class="p">:</span> <span class="kt">UDINT</span><span class="p">;</span>
<span class="n">xEmpty</span> <span class="p">:</span> <span class="kt">BOOL</span><span class="p">;</span>

<span class="k">IF</span> <span class="n">xQuery</span> <span class="k">THEN</span>
    <span class="n">udiSize</span> <span class="p">:=</span> <span class="n">TO_UDINT</span><span class="p">(</span><span class="n">MBM.RXChgGetMsgSize</span><span class="p">(</span><span class="n">hRXChg</span><span class="p">:=</span><span class="n">hPool</span><span class="p">,</span> <span class="n">peError</span><span class="p">:=</span><span class="k">ADR</span><span class="p">(</span><span class="n">eError</span><span class="p">));</span>
    <span class="n">udiCapacity</span> <span class="p">:=</span> <span class="n">TO_UDINT</span><span class="p">(</span><span class="n">MBM.RXChgGetCurCapacity</span><span class="p">(</span><span class="n">hRXChg</span><span class="p">:=</span><span class="n">hPool</span><span class="p">,</span> <span class="n">peError</span><span class="p">:=</span><span class="k">ADR</span><span class="p">(</span><span class="n">eError</span><span class="p">));</span>
    <span class="n">udiCount</span> <span class="p">:=</span> <span class="n">TO_UDINT</span><span class="p">(</span><span class="n">MBM.XChgMsgLeft</span><span class="p">(</span><span class="n">hXChg</span><span class="p">:=</span><span class="n">hPool</span><span class="p">,</span> <span class="n">peError</span><span class="p">:=</span><span class="k">ADR</span><span class="p">(</span><span class="n">eError</span><span class="p">));</span>
    <span class="n">xEmpty</span> <span class="p">:=</span> <span class="n">MBM.XChgIsEmpty</span><span class="p">(</span><span class="n">hXChg</span><span class="p">:=</span><span class="n">hPool</span><span class="p">,</span> <span class="n">peError</span><span class="p">:=</span><span class="k">ADR</span><span class="p">(</span><span class="n">eError</span><span class="p">)</span>
    <span class="n">xQuery</span> <span class="p">:=</span> <span class="kc">FALSE</span><span class="p">;</span>
<span class="k">END_IF</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="query-the-current-state-of-a-message-queue">
<h3>Query the current state of a message queue<a class="headerlink" href="#query-the-current-state-of-a-message-queue" title="Permalink to this heading">Â¶</a></h3>
<blockquote>
<div><div class="highlight-codesys notranslate"><div class="highlight"><pre><span></span><span class="n">hQueue</span> <span class="p">:</span> <span class="n">MBM.HANDLE</span><span class="p">;</span>
<span class="n">eError</span> <span class="p">:</span> <span class="n">MBM.ERROR</span><span class="p">;</span>
<span class="n">xQuery</span> <span class="p">:</span> <span class="kt">BOOL</span><span class="p">;</span>

<span class="n">udiCount</span> <span class="p">:</span> <span class="kt">UDINT</span><span class="p">;</span>
<span class="n">xEmpty</span> <span class="p">:</span> <span class="kt">BOOL</span><span class="p">;</span>

<span class="k">IF</span> <span class="n">xQuery</span> <span class="k">THEN</span>
    <span class="n">udiCount</span> <span class="p">:=</span> <span class="n">TO_UDINT</span><span class="p">(</span><span class="n">MBM.XChgMsgLeft</span><span class="p">(</span><span class="n">hXChg</span><span class="p">:=</span><span class="n">hQueue</span><span class="p">,</span> <span class="n">peError</span><span class="p">:=</span><span class="k">ADR</span><span class="p">(</span><span class="n">eError</span><span class="p">));</span>
    <span class="n">xEmpty</span> <span class="p">:=</span> <span class="n">MBM.XChgIsEmpty</span><span class="p">(</span><span class="n">hXChg</span><span class="p">:=</span><span class="n">hQueue</span><span class="p">,</span> <span class="n">peError</span><span class="p">:=</span><span class="k">ADR</span><span class="p">(</span><span class="n">eError</span><span class="p">)</span>
    <span class="n">xQuery</span> <span class="p">:=</span> <span class="kc">FALSE</span><span class="p">;</span>
<span class="k">END_IF</span>
</pre></div>
</div>
</div></blockquote>
</section>
</section>
</section>


                        </div>
                    </div>
                </div>
            </div>

<footer id="footerWrapper">
    <div class="global-top-link to-top affix-top">
        <a href="#">
            <i class="zmdi zmdi-chevron-up"><span class="sr-only">top</span></i>
        </a>
    </div>
    <div class="inner-wrapper container-fluid">
        <div class="container">
            <div class="row">
                <div class="col-sm-12 col-footer-claim">
                    <div class="inner-wrapper">
                        <p class="claim" style="font-weight: 500;">
                            CODESYS Group | We <i>software</i> Automation.
                            <span class="info">
                                to software <br>
                                ['s&#594;ftw&#603;&#601;r] <br>
                                transitive verb <br>
                                __softwared/softwaring <br>
                                : to develop software <br>
                                // to software automation: to develop software for automation purposes
                            </span>
                        </p>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 col-footer-content">
                    <div class="frame frame-default frame-type-textmedia frame-layout-0 frame-space-before-none frame-space-after-default"
                         id="c12115">
                        <a id="c12116"></a>
                        <div class="ce-textpic ce-left ce-above fsc-textmedia layout-0">
                            <div class="ce-bodytext">
                                <p>The CODESYS Group is the manufacturer of CODESYS, the leading hardware-independent
                                    IEC 61131-3 automation software for developing and engineering controller
                                    applications.<br/>
                                    CODESYS&reg; is a registered trademark.
                                    </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6">
                    <address>
                        <div class="adr-name">CODESYS GmbH</div>
                        <div class="adr-responsive">A member of the CODESYS Group</div>
                        <div class="adr-location">Memminger Stra&szlig;e 151, 87439 Kempten</div>
                        <div class="adr-country">Germany</div>
                        <div class="adr-tel">Tel.:
                            <tcxspan tcxhref="+49831540310" title="Call  +49-831-54031-0 via 3CX"> +49-831-54031-0
                            </tcxspan>
                        </div>
                        <div class="adr-mail"><a href="javascript:linkTo_UnCryptMailto('hvdgoj5diajVxjyzntn9xjh');">info@codesys.com</a>
                        </div>
                    </address>
                </div>
                <div class="col-md-3 col-sm-6">
                    <div id="footerMenu">
                        <ul class="list-inline">
                            <li>
                                <a class="default" href="https://www.codesys.com/legal-notice.html">
                                    <span>Legal Notice</span>
                                </a>
                            </li>
                            <li>
                                <a class="default" href="https://www.codesys.com/privacy-policy.html">
                                    <span>Privacy Policy</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 col-footer-shortcuts">
                    <a href="https://www.linkedin.com/company/codesys" target="_blank">
                        <i class="zmdi zmdi-hc-fw zmdi-linkedin-box"><span class="sr-only">LinkedIn</span></i>
                    </a>
                    <a href="https://www.youtube.com/channel/UC2hQMrlITlc-JpVanRnuYdA" target="_blank">
                        <i class="zmdi zmdi-hc-fw zmdi-youtube"><span class="sr-only">Youtube</span></i>
                    </a>
                    <a href="https://www.codesys.com/news-events/publications/codesys-rss-feeds.html" target="_blank">
                        <i class="zmdi zmdi-hc-fw zmdi-rss"><span class="sr-only">RSS</span></i>
                    </a>
                    <a href="https://www.codesys.com/download.html" target="_blank">
                        <i class="zmdi zmdi-hc-fw zmdi-download"><span class="sr-only">Downloads</span></i>
                    </a>
                    <a href="http://customers.codesys.com/" target="_blank">
                        <i class="zmdi zmdi-hc-fw zmdi-lock"><span class="sr-only">Login</span></i>
                    </a>
                    <a href="https://store.codesys.com/" target="_blank">
                        <i class="zmdi zmdi-hc-fw zmdi-shopping-cart"><span class="sr-only">CODESYS Store</span></i>
                    </a>
                </div>
            </div>
            <div class="copyright">
                &copy; 2022 CODESYS GmbH
                <small class="text-muted">
                    | A member of the CODESYS Group
                </small>
            </div>
        </div>
    </div>
</footer> 

        </section>

    </div>

  
    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'3.5.21.0 (Draft)',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:false
        };
    </script>
    <script type="text/javascript" src="_static/documentation_options.js"></script>
    
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/sphinx_highlight.js"></script>
  
    <script type="text/javascript" src="_static/js/theme.js"></script>

</body>
</html>